<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UI Addons sample | RealtimeKit</title>
    <script src="https://cdn.jsdelivr.net/npm/@cloudflare/realtimekit@latest/dist/browser.js"></script>
    <script type="module">
      import { defineCustomElements } from "https://cdn.jsdelivr.net/npm/@cloudflare/realtimekit-ui@latest/loader/index.es2017.js";
      defineCustomElements();
    </script>
    <style>
      .rtk-meeting-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="rtk-meeting-container">
      <rtk-meeting
        id="my-meeting"
        class="dyte"
        show-setup-screen="true"
      ></rtk-meeting>
    </div>
    <script type="module">
      import ChatHostControl from "https://cdn.jsdelivr.net/npm/@cloudflare/realtimekit-ui-addons@latest/dist/chat-host-control.js";
      import CameraHostControl from "https://cdn.jsdelivr.net/npm/@cloudflare/realtimekit-ui-addons@latest/dist/camera-host-control.js";
      import RealtimeKitVideoBackground from "https://cdn.jsdelivr.net/npm/@cloudflare/realtimekit-ui-addons@latest/dist/video-background.js";
      import { registerAddons } from "https://cdn.jsdelivr.net/npm/@cloudflare/realtimekit-ui@latest/dist/esm/index.js";

      window.onload = async () => {

        const url = new URL(window.location.href);
        const authToken = url.searchParams.get("authToken");

        if (!authToken) {
            alert("Please provide an authToken in the URL");
            return;
        }

        // Initializes a meeting.
        const meeting = await RealtimeKitClient.init({
          authToken,
          defaults: {
            audio: true,
            video: true,
            mediaConfiguration: {
              audio: {
                echoCancellation: false,
                noiseSupression: false,
              }
            }
          },
        });
      
        const chatHostControl = await ChatHostControl.init({
          meeting,
          hostPresets: ['webinar_presenter'],
          targetPresets: ['webinar_viewer'],
          addActionInParticipantMenu: true,
        });

        const videoBackground = await RealtimeKitVideoBackground.init({
            modes: ["blur", "virtual"],
            meeting,
            images: [
                "https://images.unsplash.com/photo-1487088678257-3a541e6e3922?q=80&w=2874&auto=format&fit=crop&ixlib=rb-4.0.3",
                "https://images.unsplash.com/photo-1496715976403-7e36dc43f17b?q=80&w=2848&auto=format&fit=crop&ixlib=rb-4.0.3",
                "https://images.unsplash.com/photo-1600431521340-491eca880813?q=80&w=2938&auto=format&fit=crop&ixlib=rb-4.0.3"
            ],
            onVideoBackgroundUpdate: ({backgroundMode, backgroundURL}) => { 
              console.log('videoBackgroundUpdated => ', {backgroundMode, backgroundURL});
            }, // Listen to background update action
        });

        const cameraHostControl = await CameraHostControl.init({
          meeting,
          hostPresets: ['webinar_presenter'],
          targetPresets: ['webinar_viewer'],
          addActionInParticipantMenu: true,
        });
        
        const newConfig = registerAddons([chatHostControl, cameraHostControl, videoBackground], meeting);
        
        
        document.getElementById("my-meeting").showSetupScreen = true;
        document.getElementById("my-meeting").meeting = meeting;
        document.getElementById("my-meeting").config = newConfig;
      };
    </script>
  </body>
</html>
